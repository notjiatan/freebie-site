---
import BaseLayout from "@components/base/BaseLayout.astro";
import { markdownify } from "@lib/textConverter";
import Button from "@components/common/Button.astro";
import Footer from "@components/base/Footer.astro";
import type { HomeEntry } from "@/types";
import { Image } from "astro:assets";
import { getIndex } from "@lib/contentParser";

interface Props {
  entry: HomeEntry;
}

const { entry } = Astro.props;
const { image, imageAlt, title, content, button } = entry.data;
const whatWeOfferEntry = await getIndex("what-we-offer");
const { title: offerTitle, description: offerDesc, offerings } = whatWeOfferEntry.data;
---

<BaseLayout>
  <!-- Banner -->
  <section class="section">
    <div class="container">
      <div class="row justify-center">
        <div class="text-center lg:col-6">
          {
            image && (
              <div class="blur-[0px]">
                <Image
                class="mb-6 w-64 svg-glow"
                src={image}
                alt={imageAlt}
                width={1024}
                height={1024}
                loading="eager"
              />
              </div>
              
            )
          }
          <h1 set:html={markdownify(title)} class="mb-4 flicker-text neon-title" />
          <p set:html={markdownify(content)} class="mb-8 neon-subtitle" />
          {
            button && (
              <>
                <div class="mb-4">
                  <h2 class="section-title">Proof & Testimonials</h2>
                </div>
                <Button
                  label={button.label}
                  link={button.link}
                  newtab
                  hoverInvert
                  color=""
                />
                <div class="mt-8">
                  <iframe
                    style="width: 100%; max-width: 800px; height: 400px; border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px;"
                    title="Stoat Chat"
                  ></iframe>
                </div>
              </>
            )
          }
        </div>
      </div>
    </div>
  </section>

  <!-- Carousel Section - Freebie Categories -->
  <section class="section">
    <div class="container">
      <div class="row justify-center">
        <div class="text-center mb-4">
          <h2 class="section-title">Featured Services</h2>
        </div>
        <div class="text-center mb-8">
          <Button
            label="View ALL Our Services (WE HAVE DOZENS)"
            link="#"
            hoverInvert
            color=""
          />
        </div>
        <div class="col-12">
          <!-- Horizontal Scrolling Carousel -->
          <div class="carousel" mask>
            <!-- Greggs -->
            <article>
              <img src="https://images.unsplash.com/photo-1555507036-ab1f4038808a?w=1260&h=750&fit=crop" alt="Greggs bakery and food">
              <h2>Greggs</h2>
              <div>
                <p>Get free items, meal deals, and exclusive vouchers from the UK's favorite bakery chain.</p>
              </div>
            </article>

            <!-- Apple Music -->
            <article>
              <img src="https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=1260&h=750&fit=crop" alt="Apple Music streaming">
              <h2>Apple Music</h2>
              <div>
                <p>Access premium Apple Music subscriptions and extended free trials for unlimited music streaming.</p>
              </div>
            </article>

            <!-- Amazon Prime -->
            <article>
              <img src="https://images.unsplash.com/photo-1523474253046-8cd2748b5fd2?w=1260&h=750&fit=crop" alt="Amazon Prime delivery and streaming">
              <h2>Amazon Prime</h2>
              <div>
                <p>Unlock Amazon Prime membership benefits including free shipping, Prime Video, and exclusive deals.</p>
              </div>
            </article>

            <!-- Uber Eats -->
            <article>
              <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1260&h=750&fit=crop" alt="Uber Eats food delivery">
              <h2>Uber Eats</h2>
              <div>
                <p>Score free delivery vouchers, promotional codes, and meal discounts from Uber Eats.</p>
              </div>
            </article>

            <!-- Nandos -->
            <article>
              <img src="https://images.unsplash.com/photo-1598103442097-8b74394b95c6?w=1260&h=750&fit=crop" alt="Nandos restaurant food">
              <h2>Nandos</h2>
              <div>
                <p>Get free Nando's meals, loyalty rewards, and exclusive dining vouchers for your favorite peri-peri chicken.</p>
              </div>
            </article>

            <!-- McDonalds -->
            <article>
              <img src="https://images.unsplash.com/photo-1619454016518-697bc231e7cb?w=1260&h=750&fit=crop" alt="McDonald's fast food">
              <h2>McDonald's</h2>
              <div>
                <p>Access free McDonald's vouchers, app deals, and exclusive promotions for your favorite fast food.</p>
              </div>
            </article>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- How It Works Section -->
  <section class="section">
    <div class="container">
      <div class="row justify-center">
        <div class="text-center mb-12">
          <h2 class="section-title">How It Works</h2>
        </div>
      </div>
      <div class="row justify-center">
        <div class="col-12">
          <div class="how-it-works-wrapper">
            <!-- Vertical scroll indicator -->
            <div class="scroll-indicator">
              <div class="scroll-line"></div>
              <div class="scroll-fill"></div>
              <div class="scroll-circle"></div>
            </div>

            <!-- Steps -->
            <div class="steps-container">
              <!-- Step 1 -->
              <div class="step-item">
                <div class="step-content">
                  <div class="step-image">
                    <img src="https://images.unsplash.com/photo-1614680376593-902f74cf0d41?w=600&h=600&fit=crop" alt="Join Discord community" loading="lazy" />
                  </div>
                  <div class="step-text">
                    <h3 class="step-title">Step 1 — Join the Community</h3>
                    <p class="step-description">Get instant access to our exclusive Discord community where freebies and deals are posted daily.</p>
                  </div>
                </div>
              </div>

              <!-- Step 2 -->
              <div class="step-item">
                <div class="step-content">
                  <div class="step-image">
                    <img src="https://images.unsplash.com/photo-1607799279861-4dd421887fb3?w=600&h=600&fit=crop" alt="Browse freebies" loading="lazy" />
                  </div>
                  <div class="step-text">
                    <h3 class="step-title">Step 2 — Browse Available Freebies</h3>
                    <p class="step-description">Explore hundreds of free items, subscriptions, and exclusive deals updated in real-time.</p>
                  </div>
                </div>
              </div>

              <!-- Step 3 -->
              <div class="step-item">
                <div class="step-content">
                  <div class="step-image">
                    <img src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=600&h=600&fit=crop" alt="Claim rewards" loading="lazy" />
                  </div>
                  <div class="step-text">
                    <h3 class="step-title">Step 3 — Claim Your Rewards</h3>
                    <p class="step-description">Follow simple instructions to claim freebies. The more you claim, the more you save!</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- What We Offer Section -->
  <section class="section">
    <div class="container">
      <div class="row justify-center">
        <div class="text-center mb-12">
          <h2 class="section-title">{offerTitle}</h2>
          {offerDesc && <p class="text-lg neon-subtitle opacity-80 mt-4">{offerDesc}</p>}
        </div>
      </div>
      <div class="row justify-center">
        <div class="col-12">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {offerings.map((offering) => (
              <div class="offering-card">
                <div class="offering-card-content">
                  <h3 class="offering-card-title">{offering.title}</h3>
                  <p class="offering-card-description" set:html={offering.description} />
                  {offering.brandIcons && offering.brandIcons.length > 0 && (
                    <div class="offering-brand-icons">
                      {offering.brandIcons.map((iconUrl) => (
                        <div class="brand-icon">
                          <img src={iconUrl} alt="Brand icon" />
                        </div>
                      ))}
                    </div>
                  )}
                </div>
                {offering.icon && (
                  <div class="offering-card-icon">
                    <img src={offering.icon} alt={offering.title} />
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Pricing Cards Section -->
  <section class="section">
    <div class="container">
      <div class="row justify-center">
        <div class="text-center mb-4">
          <h2 class="section-title">Tiers</h2>
        </div>
        <div class="text-center mb-8">
          <Button
            label="View Our Full Tiers & Pricing Breakdown, with all included services"
            link="#"
            hoverInvert
            color=""
          />
        </div>
        <div class="flex justify-center gap-8 flex-wrap">
          <!-- SVG Filters for turbulent displacement effect -->
          <svg style="position: absolute; width: 0; height: 0;">
            <defs>
              <filter id="turbulent-displace" colorInterpolationFilters="sRGB" x="-20%" y="-20%" width="140%" height="140%">
                <!-- Lightweight turbulence with minimal octaves -->
                <feTurbulence type="turbulence" baseFrequency="0.01" numOctaves="2" result="noise" seed="1">
                  <animate attributeName="baseFrequency" values="0.01; 0.02; 0.01" dur="10s" repeatCount="indefinite" />
                </feTurbulence>
                <!-- Apply subtle displacement -->
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="15" xChannelSelector="R" yChannelSelector="G" />
              </filter>
            </defs>
          </svg>

          <!-- Free Tier Card -->
          <div class="simple-card-container">
            <div class="simple-card-content">
              <div class="electric-content-top">
                <div class="simple-badge">
                  Free Tier
                </div>
                <p class="electric-title"><u>You Get:</u></p>
              </div>

              <hr class="electric-divider" />

              <div class="electric-content-bottom">
                <p class="electric-description">> 1 Trial Generation (from the free section) <i>[PER USER IP ADDRESS]</i><br>> Access to Free Guides & Giveaways<br>> Our Community Chat</p>
              </div>
            </div>
          </div>

          <!-- Electric Border Card Component (Premium) -->
          <div class="electric-card-container">
            <div class="electric-inner-container">
              <div class="electric-border-outer">
                <div class="electric-main-card"></div>
              </div>
              <div class="electric-glow-layer-1"></div>
              <div class="electric-glow-layer-2"></div>
            </div>

            <!-- Overlay effects for additional lighting -->
            <div class="electric-overlay-1"></div>
            <div class="electric-overlay-2"></div>
            <div class="electric-background-glow"></div>

            <!-- Card content -->
            <div class="electric-content-container">
              <div class="electric-content-top">
                <div class="electric-scrollbar-glass">
                  Finder Plus
                </div>
                <p class="electric-title"><u>You Unlock:</u></p>
              </div>

              <hr class="electric-divider" />

              <div class="electric-content-bottom">
                <p class="electric-description">> Unlimited Refills<br>> Much Much Much Faster Cooldowns<br>> <u>Unlock EVERYTHING</u>, ALL Services, Free Items, Exclusive Discounts, Free Subscription Services Accounts, etc.<br>> 24/7 Customer Support</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Our Stats Section -->
  <section class="section">
    <div class="container">
      <div class="row justify-center">
        <div class="text-center mb-12">
          <h2 class="section-title">Our Stats</h2>
        </div>
      </div>
      <div class="row justify-center">
        <div class="col-12">
          <!-- Stats content will go here -->
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<Footer />

<script>
  // Animated scroll indicator for "How It Works" section
  function initScrollIndicator() {
    const wrapper = document.querySelector('.how-it-works-wrapper') as HTMLElement;
    if (!wrapper) return;

    const indicator = wrapper.querySelector('.scroll-indicator') as HTMLElement;
    const circle = wrapper.querySelector('.scroll-circle') as HTMLElement;
    const fill = wrapper.querySelector('.scroll-fill') as HTMLElement;

    if (!indicator || !circle || !fill) return;

    // Smooth animation variables
    let currentPos = 0;
    let targetPos = 0;
    const ease = 0.15;

    function clamp(val: number, min: number, max: number): number {
      return Math.max(min, Math.min(max, val));
    }

    function updateIndicator() {
      const rect = wrapper.getBoundingClientRect();
      const viewportMid = window.innerHeight / 2;

      // Calculate target position based on scroll
      targetPos = clamp(viewportMid - rect.top, 0, rect.height);

      // Smooth interpolation
      currentPos += (targetPos - currentPos) * ease;

      // Apply transforms
      circle.style.top = `${currentPos}px`;
      fill.style.height = `${currentPos}px`;

      requestAnimationFrame(updateIndicator);
    }

    // Start animation
    updateIndicator();
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initScrollIndicator);

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initScrollIndicator);
</script>
